(function() {
  var bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    hasProp = {}.hasOwnProperty;

  Elegance.Controller = (function() {
    Controller.prototype.events = {};

    function Controller(app, route) {
      var event, method, ref, selector;
      this.app = app;
      this.route = route;
      this.onDataChange = bind(this.onDataChange, this);
      this.element = null;
      this.initialized = false;
      this.data = null;
      this.listeners = [];
      this.dirty = false;
      this.app = this.app;
      this.element = $("#" + this.route.name).first();
      if (this.element.length === 0) {
        this.element = null;
        throw new Error("Controller " + this.constructor.name + " has no template element.\r Create an element with an id of '" + this.route.name + "'.");
      } else {
        this.element.hide();
        ref = this.events;
        for (event in ref) {
          if (!hasProp.call(ref, event)) continue;
          method = ref[event];
          event = event.split(' ');
          selector = event.pop();
          event = event[0];
          this.bindEvent(this.element, event, selector, this[method]);
        }
      }
    }

    Controller.prototype.bindEvent = function(container, event, selector, method) {
      var callback, self;
      if (event === 'submit') {
        self = this;
        callback = function(e) {
          var child, children, i, input, len, name, tag;
          e.preventDefault();
          input = {};
          children = $(this).find('input, select, textarea');
          for (i = 0, len = children.length; i < len; i++) {
            child = children[i];
            child = $(child);
            name = child.attr('name');
            if (name != null) {
              tag = child.prop('tagName');
              tag = tag.toLowerCase();
              if (tag === 'input' || tag === 'textarea') {
                input[name] = child.val();
              }
            }
          }
          return method(input);
        };
        return container.on(event, selector, callback);
      } else {
        return container.on(event, selector, method);
      }
    };

    Controller.prototype.setData = function(data) {
      if (this.data != null) {
        this.data.off('change', this.listeners);
        this.listeners = [];
      }
      this.data = data;
      if (this.data != null) {
        this.listeners.push(this.data.on('change', this.onDataChange));
      }
      return this.onDataChange();
    };

    Controller.prototype.onDataChange = function() {
      if (this.isShown()) {
        return this.render();
      } else {
        return this.dirty = true;
      }
    };

    Controller.prototype.init = function() {
      return this.initialized = true;
    };

    Controller.prototype.isShown = function() {
      if (this.element != null) {
        if (this.element.css('display') === 'none') {
          return false;
        }
        return true;
      }
      return false;
    };

    Controller.prototype.show = function() {
      if (this.element != null) {
        if (this.dirty) {
          this.render();
          this.dirty = false;
        }
        return this.element.show();
      }
    };

    Controller.prototype.hide = function() {
      console.log('hiding controller');
      if (this.element) {
        return this.element.hide();
      }
    };

    Controller.prototype.render = function() {
      return this.app.render(this.element, this.data);
    };

    return Controller;

  })();

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbnRyb2xsZXIvQ29udHJvbGxlci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBOytCQUFBOztBQUFBLEVBQU0sUUFBUSxDQUFDO0FBQ2QseUJBQUEsTUFBQSxHQUFRLEVBQVIsQ0FBQTs7QUFFYSxJQUFBLG9CQUFDLEdBQUQsRUFBTyxLQUFQLEdBQUE7QUFDWixVQUFBLDRCQUFBO0FBQUEsTUFEYSxJQUFDLENBQUEsTUFBRCxHQUNiLENBQUE7QUFBQSxNQURtQixJQUFDLENBQUEsUUFBRCxLQUNuQixDQUFBO0FBQUEsdURBQUEsQ0FBQTtBQUFBLE1BQUEsSUFBQyxDQUFBLE9BQUQsR0FBVyxJQUFYLENBQUE7QUFBQSxNQUNBLElBQUMsQ0FBQSxXQUFELEdBQWUsS0FEZixDQUFBO0FBQUEsTUFFQSxJQUFDLENBQUEsSUFBRCxHQUFRLElBRlIsQ0FBQTtBQUFBLE1BR0EsSUFBQyxDQUFBLFNBQUQsR0FBYSxFQUhiLENBQUE7QUFBQSxNQUlBLElBQUMsQ0FBQSxLQUFELEdBQVMsS0FKVCxDQUFBO0FBQUEsTUFLQSxJQUFDLENBQUEsR0FBRCxHQUFPLElBQUMsQ0FBQSxHQUxSLENBQUE7QUFBQSxNQVFBLElBQUMsQ0FBQSxPQUFELEdBQVcsQ0FBQSxDQUFFLEdBQUEsR0FBSSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQWpCLENBQXdCLENBQUMsS0FBekIsQ0FBQSxDQVJYLENBQUE7QUFTQSxNQUFBLElBQUcsSUFBQyxDQUFBLE9BQU8sQ0FBQyxNQUFULEtBQW1CLENBQXRCO0FBQ0MsUUFBQSxJQUFDLENBQUEsT0FBRCxHQUFXLElBQVgsQ0FBQTtBQUNBLGNBQVUsSUFBQSxLQUFBLENBQU0sYUFBQSxHQUFjLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBL0IsR0FBb0MsK0RBQXBDLEdBQ21CLElBQUksQ0FBQyxLQUFLLENBQUMsSUFEOUIsR0FDbUMsSUFEekMsQ0FBVixDQUZEO09BQUEsTUFBQTtBQU1DLFFBQUEsSUFBQyxDQUFB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LCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBFbGVnYW5jZS5Db250cm9sbGVyXHJcblx0ZXZlbnRzOiB7fVxyXG5cclxuXHRjb25zdHJ1Y3RvcjogKEBhcHAsIEByb3V0ZSkgLT5cclxuXHRcdEBlbGVtZW50ID0gbnVsbFxyXG5cdFx0QGluaXRpYWxpemVkID0gZmFsc2VcclxuXHRcdEBkYXRhID0gbnVsbFxyXG5cdFx0QGxpc3RlbmVycyA9IFtdXHJcblx0XHRAZGlydHkgPSBmYWxzZVxyXG5cdFx0QGFwcCA9IEBhcHBcclxuXHJcblx0XHQjIEZpbmQgYXNzb2NpYXRlZCB0ZW1wbGF0ZSBlbGVtZW50XHJcblx0XHRAZWxlbWVudCA9ICQoXCIjI3t0aGlzLnJvdXRlLm5hbWV9XCIpLmZpcnN0KClcclxuXHRcdGlmIEBlbGVtZW50Lmxlbmd0aCA9PSAwXHJcblx0XHRcdEBlbGVtZW50ID0gbnVsbFxyXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IgXCJDb250cm9sbGVyICN7dGhpcy5jb25zdHJ1Y3Rvci5uYW1lfSBoYXMgbm8gdGVtcGxhdGUgZWxlbWVudC5cXHJcclxuXHRcdFx0Q3JlYXRlIGFuIGVsZW1lbnQgd2l0aCBhbiBpZCBvZiAnI3t0aGlzLnJvdXRlLm5hbWV9Jy5cIlxyXG5cdFx0ZWxzZVxyXG5cdFx0XHQjIGhpZGUgdGhlIGVsZW1lbnQgaW5pdGlhbGx5XHJcblx0XHRcdEBlbGVtZW50LmhpZGUoKVxyXG5cclxuXHRcdFx0IyBzZXR1cCBldmVudHNcclxuXHRcdFx0Zm9yIG93biBldmVudCwgbWV0aG9kIG9mIEBldmVudHNcclxuXHRcdFx0XHRldmVudCA9IGV2ZW50LnNwbGl0ICcgJ1xyXG5cdFx0XHRcdHNlbGVjdG9yID0gZXZlbnQucG9wKClcclxuXHRcdFx0XHRldmVudCA9IGV2ZW50WzBdXHJcblxyXG5cdFx0XHRcdEBiaW5kRXZlbnQgQGVsZW1lbnQsIGV2ZW50LCBzZWxlY3RvciwgdGhpc1ttZXRob2RdXHJcblxyXG5cdGJpbmRFdmVudDogKGNvbnRhaW5lciwgZXZlbnQsIHNlbGVjdG9yLCBtZXRob2QpIC0+XHJcblx0XHRpZiBldmVudCA9PSAnc3VibWl0J1xyXG5cdFx0XHRzZWxmID0gQFxyXG5cclxuXHRcdFx0Y2FsbGJhY2sgPSAoZSkgLT5cclxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KClcclxuXHJcblx0XHRcdFx0aW5wdXQgPSB7fVxyXG5cdFx0XHRcdGNoaWxkcmVuID0gJCh0aGlzKS5maW5kKCdpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYScpXHJcblxyXG5cdFx0XHRcdGZvciBjaGlsZCBpbiBjaGlsZHJlblxyXG5cdFx0XHRcdFx0Y2hpbGQgPSAkKGNoaWxkKVxyXG5cdFx0XHRcdFx0bmFtZSA9IGNoaWxkLmF0dHIgJ25hbWUnXHJcblxyXG5cdFx0XHRcdFx0aWYgbmFtZT9cclxuXHRcdFx0XHRcdFx0dGFnID0gY2hpbGQucHJvcCAndGFnTmFtZSdcclxuXHRcdFx0XHRcdFx0dGFnID0gdGFnLnRvTG93ZXJDYXNlKClcclxuXHJcblx0XHRcdFx0XHRcdGlmIHRhZyBpcyAnaW5wdXQnIG9yIHRhZyBpcyAndGV4dGFyZWEnXHJcblx0XHRcdFx0XHRcdFx0aW5wdXRbbmFtZV0gPSBjaGlsZC52YWwoKVxyXG5cclxuXHRcdFx0XHRtZXRob2QoaW5wdXQpXHJcblx0XHRcdFx0XHJcblx0XHRcdGNvbnRhaW5lci5vbihldmVudCwgc2VsZWN0b3IsIGNhbGxiYWNrKVxyXG5cdFx0ZWxzZVxyXG5cdFx0XHRjb250YWluZXIub24oZXZlbnQsIHNlbGVjdG9yLCBtZXRob2QpXHJcblxyXG5cdHNldERhdGE6IChkYXRhKSAtPlxyXG5cdFx0IyBzdG9wIGxpc3RlbmluZyBvbiBvdXIgY3VycmVudCBkYXRhXHJcblx0XHRpZiBAZGF0YT9cclxuXHRcdFx0QGRhdGEub2ZmICdjaGFuZ2UnLCBAbGlzdGVuZXJzXHJcblx0XHRcdEBsaXN0ZW5lcnMgPSBbXVxyXG5cdFx0QGRhdGEgPSBkYXRhXHJcblxyXG5cdFx0IyBiZWdpbiBsaXN0ZW5pbmdcclxuXHRcdGlmIEBkYXRhP1xyXG5cdFx0XHRAbGlzdGVuZXJzLnB1c2ggQGRhdGEub24gJ2NoYW5nZScsIEBvbkRhdGFDaGFuZ2VcclxuXHJcblx0XHRAb25EYXRhQ2hhbmdlKClcclxuXHJcblx0b25EYXRhQ2hhbmdlOiAoKSA9PlxyXG5cdFx0IyBpZiB0aGlzIGNvbnRyb2xsZXIgaXMgc2hvd24sIGxldCdzIHJlLXJlbmRlciBpdCBhc2FwLlxyXG5cdFx0aWYgQGlzU2hvd24oKVxyXG5cdFx0XHRAcmVuZGVyKClcclxuXHRcdGVsc2VcclxuXHRcdFx0IyBvdGhlcndpc2UsIHJlLXJlbmRlciB3aGVuIHdlIG5lZWQgdG9cclxuXHRcdFx0QGRpcnR5ID0gdHJ1ZVxyXG5cclxuXHRpbml0OiAoKSAtPlxyXG5cdFx0QGluaXRpYWxpemVkID0gdHJ1ZVxyXG5cclxuXHRpc1Nob3duOiAoKSAtPlxyXG5cdFx0aWYgQGVsZW1lbnQ/XHJcblx0XHRcdGlmIEBlbGVtZW50LmNzcygnZGlzcGxheScpID09ICdub25lJ1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZVxyXG5cdFx0XHRyZXR1cm4gdHJ1ZVxyXG5cdFx0cmV0dXJuIGZhbHNlXHJcblxyXG5cdHNob3c6ICgpIC0+XHJcblx0XHRpZiBAZWxlbWVudD9cclxuXHRcdFx0aWYgQGRpcnR5XHJcblx0XHRcdFx0QHJlbmRlcigpXHJcblx0XHRcdFx0QGRpcnR5ID0gZmFsc2VcclxuXHRcdFx0QGVsZW1lbnQuc2hvdygpXHJcblxyXG5cdGhpZGU6ICgpIC0+XHJcblx0XHRjb25zb2xlLmxvZyAnaGlkaW5nIGNvbnRyb2xsZXInXHJcblx0XHRpZiBAZWxlbWVudFxyXG5cdFx0XHRAZWxlbWVudC5oaWRlKClcclxuXHJcblx0cmVuZGVyOiAoKSAtPlxyXG5cdFx0QGFwcC5yZW5kZXIgQGVsZW1lbnQsIEBkYXRhIl19