(function() {
  var bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    hasProp = {}.hasOwnProperty;

  Elegance.Controller = (function() {
    Controller.prototype.events = {};

    function Controller(app, route) {
      var event, method, ref, selector, self;
      this.app = app;
      this.route = route;
      this.onDataChange = bind(this.onDataChange, this);
      this.element = null;
      this.initialized = false;
      this.data = null;
      this.listeners = [];
      this.dirty = false;
      this.app = this.app;
      this.element = $("#" + this.route.name).first();
      if (this.element.length === 0) {
        this.element = null;
        throw new Error("Controller " + this.constructor.name + " has no template element.\r Create an element with an id of '" + this.route.name + "'.");
      } else {
        this.element.hide();
        ref = this.events;
        for (event in ref) {
          if (!hasProp.call(ref, event)) continue;
          method = ref[event];
          event = event.split(' ');
          selector = event.pop();
          event = event[0];
          if (event === 'submit') {
            self = this;
            this.element.find(selector).bind(event, function(e) {
              var child, children, i, input, len, name, tag;
              e.preventDefault();
              input = {};
              children = $(this).find('input, select, textarea');
              for (i = 0, len = children.length; i < len; i++) {
                child = children[i];
                child = $(child);
                name = child.attr('name');
                if (name != null) {
                  tag = child.prop('tagName');
                  tag = tag.toLowerCase();
                  if (tag === 'input' || tag === 'textarea') {
                    input[name] = child.val();
                  }
                }
              }
              return self[method](input);
            });
          } else {
            this.element.find(selector).bind(event, this[method]);
          }
        }
      }
    }

    Controller.prototype.setData = function(data) {
      if (this.data != null) {
        this.data.off('change', this.listeners);
        this.listeners = [];
      }
      this.data = data;
      if (this.data != null) {
        this.listeners.push(this.data.on('change', this.onDataChange));
      }
      return this.onDataChange();
    };

    Controller.prototype.onDataChange = function() {
      if (this.isShown()) {
        return this.render();
      } else {
        return this.dirty = true;
      }
    };

    Controller.prototype.init = function() {
      return this.initialized = true;
    };

    Controller.prototype.isShown = function() {
      if (this.element != null) {
        if (this.element.css('display') === 'none') {
          return false;
        }
        return true;
      }
      return false;
    };

    Controller.prototype.show = function() {
      console.log('showing controller');
      if (this.element != null) {
        if (this.dirty) {
          this.render();
          this.dirty = false;
        }
        return this.element.show();
      }
    };

    Controller.prototype.hide = function() {
      console.log('hiding controller');
      if (this.element) {
        return this.element.hide();
      }
    };

    Controller.prototype.render = function() {
      return this.app.render(this.element, this.data);
    };

    return Controller;

  })();

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbnRyb2xsZXIvQ29udHJvbGxlci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQSxNQUFBOytCQUFBOztBQUFBLEVBQU0sUUFBUSxDQUFDO0FBQ2QseUJBQUEsTUFBQSxHQUFRLEVBQVIsQ0FBQTs7QUFFYSxJQUFBLG9CQUFDLEdBQUQsRUFBTyxLQUFQLEdBQUE7QUFDWixVQUFBLGtDQUFBO0FBQUEsTUFEYSxJQUFDLENBQUEsTUFBRCxHQUNiLENBQUE7QUFBQSxNQURtQixJQUFDLENBQUEsUUFBRCxLQUNuQixDQUFBO0FBQUEsdURBQUEsQ0FBQTtBQUFBLE1BQUEsSUFBQyxDQUFBLE9BQUQsR0FBVyxJQUFYLENBQUE7QUFBQSxNQUNBLElBQUMsQ0FBQSxXQUFELEdBQWUsS0FEZixDQUFBO0FBQUEsTUFFQSxJQUFDLENBQUEsSUFBRCxHQUFRLElBRlIsQ0FBQTtBQUFBLE1BR0EsSUFBQyxDQUFBLFNBQUQsR0FBYSxFQUhiLENBQUE7QUFBQSxNQUlBLElBQUMsQ0FBQSxLQUFELEdBQVMsS0FKVCxDQUFBO0FBQUEsTUFLQSxJQUFDLENBQUEsR0FBRCxHQUFPLElBQUMsQ0FBQSxHQUxSLENBQUE7QUFBQSxNQVFBLElBQUMsQ0FBQSxPQUFELEdBQVcsQ0FBQSxDQUFFLEdBQUEsR0FBSSxJQUFJLENBQUMsS0FBSyxDQUFDLElBQWpCLENBQXdCLENBQUMsS0FBekIsQ0FBQSxDQVJYLENBQUE7QUFTQSxNQUFBLElBQUcsSUFBQyxDQUFBLE9BQU8sQ0FBQyxNQUFULEtBQW1CLENBQXRCO0FBQ0MsUUFBQSxJQUFDLENBQUEsT0FBRCxHQUFXLElBQVgsQ0FBQTtBQUNBLGNBQVUsSUFBQSxLQUFBLENBQU0sYUFBQSxHQUFjLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBL0IsR0FBb0MsK0RBQXBDLEdBQ21CLElBQUksQ0FBQyxLQUFLLENBQUMsSUFEOUIsR0FDbUMsSUFEekMsQ0FBVixDQUZEO09BQUEsTUFBQTtBQU1DLFFBQUEsSUFBQyxDQUFB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QSxHQUFTLFNBQUEsR0FBQTtBQUNSLE1BQUEsSUFBRyxvQkFBSDtBQUNDLFFBQUEsSUFBRyxJQUFDLENBQUEsT0FBTyxDQUFDLEdBQVQsQ0FBYSxTQUFiLENBQUEsS0FBMkIsTUFBOUI7QUFDQyxpQkFBTyxLQUFQLENBREQ7U0FBQTtBQUVBLGVBQU8sSUFBUCxDQUhEO09BQUE7QUFJQSxhQUFPLEtBQVAsQ0FMUTtJQUFBLENBeEVULENBQUE7O0FBQUEseUJBK0VBLElBQUEsR0FBTSxTQUFBLEdBQUE7QUFDTCxNQUFBLE9BQU8sQ0FBQyxHQUFSLENBQVksb0JBQVosQ0FBQSxDQUFBO0FBQ0EsTUFBQSxJQUFHLG9CQUFIO0FBQ0MsUUFBQSxJQUFHLElBQUMsQ0FBQSxLQUFKO0FBQ0MsVUFBQSxJQUFDLENBQUEsTUFBRCxDQUFBLENBQUEsQ0FBQTtBQUFBLFVBQ0EsSUFBQyxDQUFBLEtBQUQsR0FBUyxLQURULENBREQ7U0FBQTtlQUdBLElBQUMsQ0FBQSxPQUFPLENBQUMsSUFBVCxDQUFBLEVBSkQ7T0FGSztJQUFBLENBL0VOLENBQUE7O0FBQUEseUJBdUZBLElBQUEsR0FBTSxTQUFBLEdBQUE7QUFDTCxNQUFBLE9BQU8sQ0FBQyxHQUFSLENBQVksbUJBQVosQ0FBQSxDQUFBO0FBQ0EsTUFBQSxJQUFHLElBQUMsQ0FBQSxPQUFKO2VBQ0MsSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFULENBQUEsRUFERDtPQUZLO0lBQUEsQ0F2Rk4sQ0FBQTs7QUFBQSx5QkE0RkEsTUFBQSxHQUFRLFNBQUEsR0FBQTthQUNQLElBQUMsQ0FBQSxHQUFHLENBQUMsTUFBTCxDQUFZLElBQUMsQ0FBQSxPQUFiLEVBQXNCLElBQUMsQ0FBQSxJQUF2QixFQURPO0lBQUEsQ0E1RlIsQ0FBQTs7c0JBQUE7O01BREQsQ0FBQTtBQUFBIiwiZmlsZSI6IkNvbnRyb2xsZXIvQ29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIEVsZWdhbmNlLkNvbnRyb2xsZXJcclxuXHRldmVudHM6IHt9XHJcblxyXG5cdGNvbnN0cnVjdG9yOiAoQGFwcCwgQHJvdXRlKSAtPlxyXG5cdFx0QGVsZW1lbnQgPSBudWxsXHJcblx0XHRAaW5pdGlhbGl6ZWQgPSBmYWxzZVxyXG5cdFx0QGRhdGEgPSBudWxsXHJcblx0XHRAbGlzdGVuZXJzID0gW11cclxuXHRcdEBkaXJ0eSA9IGZhbHNlXHJcblx0XHRAYXBwID0gQGFwcFxyXG5cclxuXHRcdCMgRmluZCBhc3NvY2lhdGVkIHRlbXBsYXRlIGVsZW1lbnRcclxuXHRcdEBlbGVtZW50ID0gJChcIiMje3RoaXMucm91dGUubmFtZX1cIikuZmlyc3QoKVxyXG5cdFx0aWYgQGVsZW1lbnQubGVuZ3RoID09IDBcclxuXHRcdFx0QGVsZW1lbnQgPSBudWxsXHJcblx0XHRcdHRocm93IG5ldyBFcnJvciBcIkNvbnRyb2xsZXIgI3t0aGlzLmNvbnN0cnVjdG9yLm5hbWV9IGhhcyBubyB0ZW1wbGF0ZSBlbGVtZW50LlxcclxyXG5cdFx0XHRDcmVhdGUgYW4gZWxlbWVudCB3aXRoIGFuIGlkIG9mICcje3RoaXMucm91dGUubmFtZX0nLlwiXHJcblx0XHRlbHNlXHJcblx0XHRcdCMgaGlkZSB0aGUgZWxlbWVudCBpbml0aWFsbHlcclxuXHRcdFx0QGVsZW1lbnQuaGlkZSgpXHJcblxyXG5cdFx0XHQjIHNldHVwIGV2ZW50c1xyXG5cdFx0XHRmb3Igb3duIGV2ZW50LCBtZXRob2Qgb2YgQGV2ZW50c1xyXG5cdFx0XHRcdGV2ZW50ID0gZXZlbnQuc3BsaXQgJyAnXHJcblx0XHRcdFx0c2VsZWN0b3IgPSBldmVudC5wb3AoKVxyXG5cdFx0XHRcdGV2ZW50ID0gZXZlbnRbMF1cclxuXHRcdFx0XHRpZiBldmVudCA9PSAnc3VibWl0J1xyXG5cdFx0XHRcdFx0c2VsZiA9IEBcclxuXHRcdFx0XHRcdEBlbGVtZW50LmZpbmQoc2VsZWN0b3IpLmJpbmQgZXZlbnQsIChlKSAtPlxyXG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KClcclxuXHJcblx0XHRcdFx0XHRcdGlucHV0ID0ge31cclxuXHRcdFx0XHRcdFx0Y2hpbGRyZW4gPSAkKHRoaXMpLmZpbmQoJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhJylcclxuXHJcblx0XHRcdFx0XHRcdGZvciBjaGlsZCBpbiBjaGlsZHJlblxyXG5cdFx0XHRcdFx0XHRcdGNoaWxkID0gJChjaGlsZClcclxuXHRcdFx0XHRcdFx0XHRuYW1lID0gY2hpbGQuYXR0ciAnbmFtZSdcclxuXHJcblx0XHRcdFx0XHRcdFx0aWYgbmFtZT9cclxuXHRcdFx0XHRcdFx0XHRcdHRhZyA9IGNoaWxkLnByb3AgJ3RhZ05hbWUnXHJcblx0XHRcdFx0XHRcdFx0XHR0YWcgPSB0YWcudG9Mb3dlckNhc2UoKVxyXG5cclxuXHRcdFx0XHRcdFx0XHRcdGlmIHRhZyBpcyAnaW5wdXQnIG9yIHRhZyBpcyAndGV4dGFyZWEnXHJcblx0XHRcdFx0XHRcdFx0XHRcdGlucHV0W25hbWVdID0gY2hpbGQudmFsKClcclxuXHJcblx0XHRcdFx0XHRcdHNlbGZbbWV0aG9kXShpbnB1dClcclxuXHRcdFx0XHRlbHNlXHJcblx0XHRcdFx0XHRAZWxlbWVudC5maW5kKHNlbGVjdG9yKS5iaW5kKGV2ZW50LCB0aGlzW21ldGhvZF0pXHJcblxyXG5cdHNldERhdGE6IChkYXRhKSAtPlxyXG5cdFx0IyBzdG9wIGxpc3RlbmluZyBvbiBvdXIgY3VycmVudCBkYXRhXHJcblx0XHRpZiBAZGF0YT9cclxuXHRcdFx0QGRhdGEub2ZmICdjaGFuZ2UnLCBAbGlzdGVuZXJzXHJcblx0XHRcdEBsaXN0ZW5lcnMgPSBbXVxyXG5cdFx0QGRhdGEgPSBkYXRhXHJcblxyXG5cdFx0IyBiZWdpbiBsaXN0ZW5pbmdcclxuXHRcdGlmIEBkYXRhP1xyXG5cdFx0XHRAbGlzdGVuZXJzLnB1c2ggQGRhdGEub24gJ2NoYW5nZScsIEBvbkRhdGFDaGFuZ2VcclxuXHJcblx0XHRAb25EYXRhQ2hhbmdlKClcclxuXHJcblx0b25EYXRhQ2hhbmdlOiAoKSA9PlxyXG5cdFx0IyBpZiB0aGlzIGNvbnRyb2xsZXIgaXMgc2hvd24sIGxldCdzIHJlLXJlbmRlciBpdCBhc2FwLlxyXG5cdFx0aWYgQGlzU2hvd24oKVxyXG5cdFx0XHRAcmVuZGVyKClcclxuXHRcdGVsc2VcclxuXHRcdFx0IyBvdGhlcndpc2UsIHJlLXJlbmRlciB3aGVuIHdlIG5lZWQgdG9cclxuXHRcdFx0QGRpcnR5ID0gdHJ1ZVxyXG5cclxuXHRpbml0OiAoKSAtPlxyXG5cdFx0QGluaXRpYWxpemVkID0gdHJ1ZVxyXG5cclxuXHRpc1Nob3duOiAoKSAtPlxyXG5cdFx0aWYgQGVsZW1lbnQ/XHJcblx0XHRcdGlmIEBlbGVtZW50LmNzcygnZGlzcGxheScpID09ICdub25lJ1xyXG5cdFx0XHRcdHJldHVybiBmYWxzZVxyXG5cdFx0XHRyZXR1cm4gdHJ1ZVxyXG5cdFx0cmV0dXJuIGZhbHNlXHJcblxyXG5cdHNob3c6ICgpIC0+XHJcblx0XHRjb25zb2xlLmxvZyAnc2hvd2luZyBjb250cm9sbGVyJ1xyXG5cdFx0aWYgQGVsZW1lbnQ/XHJcblx0XHRcdGlmIEBkaXJ0eVxyXG5cdFx0XHRcdEByZW5kZXIoKVxyXG5cdFx0XHRcdEBkaXJ0eSA9IGZhbHNlXHJcblx0XHRcdEBlbGVtZW50LnNob3coKVxyXG5cclxuXHRoaWRlOiAoKSAtPlxyXG5cdFx0Y29uc29sZS5sb2cgJ2hpZGluZyBjb250cm9sbGVyJ1xyXG5cdFx0aWYgQGVsZW1lbnRcclxuXHRcdFx0QGVsZW1lbnQuaGlkZSgpXHJcblxyXG5cdHJlbmRlcjogKCkgLT5cclxuXHRcdEBhcHAucmVuZGVyIEBlbGVtZW50LCBAZGF0YSJdfQ==